<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rider GPS Tracking</title>
    <link rel="stylesheet" href="">
</head>
<body>
    <div class="roq">
        <div class="title">Updated</div>
        <div class="data" id = "date"></div>
    </div>

    <div class="row">
        <div class="title">Latitude, Longitude</div>
        <div class = "data">
            <span id="lat"></span>, <span id="lng"></span>
        </div>
    </div>

    <script>
        //properties
        var track = {
            rider : 999,
            delay : 10000, //delay gps update (ms)
            timer : null, //interval timer
            hDate : null, // html last updated
            hLat : null, //html latitude
            hLang : null, //html longitude

            init : () => {
            // html elements
               track.hDAte = documnet.getElementById ("date");
               track.hDAte = documnet.getElementById ("lat");
               track.hDAte = documnet.getElementById ("lng");

            // start tracking
                track.update();
                track.timer = setInterval(track.update, track.delay);
            },
            //gps coordinates to server
            update : () => navigator.geolocation.getCurrentPoition (
                pos => {
                    var data = new FormData();
                    data.append ("req", "update");
                    data.append ("id", track.rider);
                    data.append ("lat", pos.coords.latitude);
                    data.append ("id", pos.coords.longitude);

                    fetch("ajaxTrack.php", { method: "post"}) 
                    .then(res=> res.text())
                    .then (txt => {
                        if (txt == "OK") {
                            let now = new Date();
                            track.hDate.innerHTML = now.toString();
                            track.hLat.innerHTML = pos.coord.latitude;
                            track.hLng.innerHTML = pos.coords.llongitude;
                        } else { track.error(tct); }
                    })
                    .catch(err => track.error(err));
                },
                err => track.error(err)
            ),

            error : err => {
                console.error(err);
                alert ("An error has occured!");
                clearInterval(track.timer);
            }
        }

    </script>
</body>
</html>